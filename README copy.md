# Session Module Architecture

## 1. Vision & Philosophy

The Session module is the "Game Engine" of Plex Movie Picker. While the V1 focuses on a Tinder-like experience, the architecture is designed to support multiple game modes (Bracket Tournament, Survivor/Veto, Auction/Bidding) without rewriting the core logic.

This flexibility is achieved through the **Strategy Pattern** and **Polymorphic Data Structures**.

## 2. Core Concepts

### The Game Engine (Strategy Pattern)

The `Session` entity is agnostic of the game rules. It delegates rule enforcement and win conditions to a `GameStrategy`.

```typescript
interface IGameStrategy {
  // Pure function: (Current State + New Action) -> New State
  processAction(session: Session, action: GameAction, allActions: GameAction[]): GameState;
  
  // Setup initial state (e.g. generate bracket tree)
  initialize(session: Session): Record<string, unknown>;
}
```

**Implementations:**
- `TinderGameStrategy` (V1): Counts likes. Win if `likes >= user_count`.
- `BracketGameStrategy` (Future): Manages tournament tree progression.
- `SurvivorGameStrategy` (Future): Manages elimination rounds.

### Polymorphic Actions

Instead of hardcoding table columns like `liked` or `superliked`, we use a generic Action structure. This allows us to store any type of player move.

```typescript
class GameAction {
  userId: string;
  type: 'SWIPE' | 'VOTE_BRACKET' | 'BID' | 'VETO';
  payload: Record<string, unknown>; // flexible JSON
}
```

**Examples:**
- **Tinder:** `{ type: 'SWIPE', payload: { movieId: 'xyz', liked: true } }`
- **Auction:** `{ type: 'BID', payload: { movieId: 'xyz', amount: 5 } }`
- **Veto:** `{ type: 'VETO', payload: { movieId: 'xyz' } }`

## 3. Join Mechanism (Zero Friction)

To adhere to the "Zero Friction" principle, joining must be instantaneous.

### Flow
1. **Host** creates a session -> receives a short code (e.g. `ABCD`).
2. **Guest** scans a QR Code OR visits `plex-picker.com/join/ABCD`.
3. **Guest** enters a nickname (Anonymous Auth).
4. **Guest** is in the lobby.

### Artifacts
- **Short Code:** 4 chars (A-Z, 0-9), easy to shout across the living room.
- **QR Code:** Generated by the Host's app, contains the deep link.
- **Deep Link:** `app://session/join?code=ABCD` (for mobile) or https link (for PWA).

